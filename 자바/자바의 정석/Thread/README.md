13\. Thread
===
이펙티브 자바 스터디를 진행하면서 쓰레드에 대해 아는게 없음을 깨달았다. 자바의 정석을 먼저 복습하여 쓰레드를 학습해보자.

## 01 프로세스와 쓰레드
### 프로세스(process)
- 실행 중인 프로그램. 프로그램을 실행하면 OS로부터 실행에 필요한 자원을 할당받아 프로세스가 된다.
- 프로그램 수행에 필요한 데이터와 메모리 등의 자원 그리고 쓰레드로 구성되어 있다.

### 쓰레드(thread)
- 프로세스의 자원을 이용해서 실제로 작업을 수행한다.
- 모든 프로세스에는 최소한 하나 이상의 스레드가 존재한다.

## 02 멀티쓰레딩의 장단점
### 멀티쓰레딩
싱글쓰레드라면 한 번에 한 작업밖에 할 수 없다. 여러 사용자에게 서비스를 제공하는 경우 멀티쓰레딩은 필수적이다.
여러 쓰레드를 생성해서 사용자의 요청과 일대일로 처리되도록 프로그래밍 해야 한다.

프로세스를 생성하는 것은 쓰레드를 생성하는 것에 비해 시간과 메모리 공간이 필요하다.
- 동일한 작업을 하는 프로세스를 여러개 만들면 손해일 것이다.
- PCB의 모양을 기억하자. 쓰레드는 프로세스에서 공유가능한 값들은 공유하여 효율적으로 사용한다.
- 쓰레드는 동료 쓰레드와 code section, data section, OS resouces를 공유한다.

### 장점
- CPU 사용률 향상
- 자원을 보다 효율적으로 사용
- 사용자에 대한 응답성 향상
- 작업이 분리되어 코드가 간결해진다.

### 장점만 존재하진 않는다.
- 동기화, 교착상태를 고려해 신중하게 프로그래밍해야 한다.

## 03 - 05 쓰레드의 구현과 실행

### 구현
1. Thread클래스를 상속
2. Runnable 인터페이스를 구현

두 경우 모두 `run()` 메서드의 구현부를 만들어주기만 하면 된다. 
Runnable 인터페이스를 구현하는 방법은 더 높은 재사용성을 가질 수 있다.
![img.png](img.png)
- Thread는 Runnable을 구현하며, Runnable을 private 필드로 가지고 있다.  
- 기본적으로 Thread 생성자에 Runnable 인스턴스를 인수로 넘기면 필드에 저장하는 방식이다.

### 실행

```java
class ThreadEx1 {
	public static void main(String args[]) {
		ThreadEx1_1 t1 = new ThreadEx1_1();

		Runnable r  = new ThreadEx1_2();
		Thread   t2 = new Thread(r);	  // 생성자 Thread(Runnable target)

		t1.start();
		t2.start();
	}
}

class ThreadEx1_1 extends Thread {
	public void run() {
		for(int i=0; i < 5; i++) {
			System.out.println(getName()); // 조상인 Thread의 getName()을 호출
		}
	}
}

class ThreadEx1_2 implements Runnable {
	public void run() {
		for(int i=0; i < 5; i++) {
			// Thread.currentThread() - 현재 실행중인 Thread를 반환한다.
		    System.out.println(Thread.currentThread().getName());
		}
	}
}
```
- getName으로 Thread의 이름을 가져오기도 한다.
- Runnable 인스턴스를 생성자에 제공하는 것을 볼 수 있다.

### 실행 - start()
- 쓰레드를 생성하고 start()를 호출해야만 쓰레드가 실행된다.  
- **하지만** start()가 호출되었다고 해서 바로 실행되지 않는다. 
실행대기 상태에 있다가 <u>자신의 차례가 되어야 실행</u>된다. 물론 실행대기중인 쓰레드가 하나도 없으면 곧바로 실행 상태가 된다.

❗실행이 종료된 쓰레드는 다시 실행할 수 없다.
- 하나의 쓰레드에 대해 start()가 한 번만 호출될 수 있다는 의미
- 작업을 한 번 더 수행해야 한다면 새로운 쓰레드를 생성한 다음에 start()를 호출해야 한다.
- 두 번 이상 호출 시 IllegalThreadStateException 발생

## 06 start() 와 run()
- main메서드에서 run()을 호출하는 것은 생성된 쓰레드를 실행시키는게 아니라
단순히 클래스에 선언된 메서드를 호출하는 것이다.
- start()는 새로운 쓰레드가 작업을 실행하는데 필요한 호출스택을 생성한 다음에 run()을 호출해서 생성된 호출스택에 run()이 첫 번째로 올라가게 한다.

## 과정
1. main메서드에서 쓰레드의 start()를 호출
2. start()는 새로운 쓰레드를 생성, 쓰레드가 작업하는데 사용될 호출스택을 생성한다.
3. 새로 생성된 호출스택에 run()이 호출되어, 쓰레드가 독립된 공간에서 작업을 수행한다.
4. 두 호출 스택이 스케줄러가 정한 순서에 의해서 번갈아 실행된다.

## 07 main쓰레드
- main 메서드를 실행하는 쓰레드
- 프로그램을 실행하면 기본적으로 하나의 쓰레드를 생성하고, main 메서드를 호출해서 작업이 수행되도록 하는 것이다.
- 실행 중인 사용자 쓰레드가 하나도 없을 때 프로그램은 종료된다.